<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="user/layout/header :: layout(~{::body})">

<head>
	<style>
		/* Layout chung */
		.checkout_section {
			padding: 40px 0;
			background-color: #f8f9fa;
		}

		/* Card styles */
		.white_shd {
			background: #fff;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			padding: 20px;
			margin-bottom: 30px;
		}

		/* Product list styles */
		.product_img img {
			width: 80px;
			height: 80px;
			object-fit: cover;
			border-radius: 4px;
		}

		.product_detail {
			margin-left: 100px;
			/* Space for image */
		}

		.product_detail h4 {
			margin: 0;
			font-size: 16px;
			font-weight: 500;
		}

		/* Table styles */
		.table td {
			vertical-align: middle;
			padding: 15px;
		}

		.table-striped tbody tr {
			background-color: #fff;
		}

		.table-striped tbody tr:nth-of-type(odd) {
			background-color: #f8f9fa;
		}

		/* Form styles */
		.form-control {
			height: 45px;
			border-color: #ddd;
		}

		textarea.form-control {
			height: auto;
		}

		.form-control:focus {
			border-color: #4CAF50;
			box-shadow: 0 0 0 0.2rem rgba(76, 175, 80, .25);
		}

		/* Summary section */
		.order-summary-total {
			border-top: 1px solid #ddd;
			margin-top: 20px;
			padding-top: 20px;
		}

		/* Button styles */
		.btn-primary {
			background-color: #4CAF50;
			border-color: #4CAF50;
			padding: 12px 25px;
			font-size: 16px;
			width: 100%;
		}

		.btn-primary:hover {
			background-color: #45a049;
			border-color: #45a049;
		}

		/* Heading styles */
		.heading1 {
			border-bottom: 1px solid #ddd;
			padding-bottom: 15px;
			margin-bottom: 20px;
		}

		.heading1 h2 {
			margin: 0;
			font-size: 20px;
			color: #333;
		}

		/* Responsive styles */
		@media (max-width: 768px) {

			.col-md-8,
			.col-md-4 {
				padding: 0 15px;
			}

			.white_shd {
				margin-bottom: 20px;
			}
		}
	</style>
</head>

<body id="default_theme" class="checkout_page">
	<!-- inner page banner -->
	<div id="inner_banner" class="section inner_banner_section">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="full">
						<div class="title-holder">
							<div class="title-holder-cell text-left">
								<h1 class="page-title">Thanh Toán</h1>
								<ol class="breadcrumb">
									<li><a href="/">Trang chủ</a></li>
									<li><a href="/cart">Giỏ hàng</a></li>
									<li class="active">Thanh toán</li>
								</ol>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="section padding_layout_1 checkout_section">
		<div class="container">
			<!-- Form thông tin đặt hàng -->
			<div class="white_shd full margin_bottom_30">
				<div class="full graph_head">
					<div class="heading1 margin_0">
						<h2>Thông tin đặt hàng</h2>
					</div>
				</div>
				<div class="full padding_infor_info">
					<form th:action="@{/checkout/place-order}" method="post" class="needs-validation" id="checkout-form"
						novalidate>
						<div class="row">
							<div class="col-md-6 mb-3">
								<label for="fullName">Họ và tên *</label>
								<input type="text" class="form-control" id="fullName" name="fullName"
									th:value="${user.fullName}" required>
								<div class="invalid-feedback">Vui lòng nhập họ tên</div>
							</div>
							<div class="col-md-6 mb-3">
								<label for="phone">Số điện thoại *</label>
								<input type="tel" class="form-control" id="phone" name="phone" th:value="${user.phone}"
									required>
								<div class="invalid-feedback">Vui lòng nhập số điện thoại</div>
							</div>
						</div>

						<div class="mb-3">
							<label for="email">Email *</label>
							<input type="email" class="form-control" id="email" name="email" th:value="${user.email}"
								required>
							<div class="invalid-feedback">Vui lòng nhập email hợp lệ</div>
						</div>

						<div class="mb-3">
							<label for="address">Địa chỉ giao hàng *</label>
							<input type="text" class="form-control" id="address" name="address"
								th:value="${user.address}" required>
							<div class="invalid-feedback">Vui lòng nhập địa chỉ giao hàng</div>
						</div>

						<div class="mb-3">
							<label for="note">Ghi chú</label>
							<textarea class="form-control" id="note" name="note" rows="3"></textarea>
						</div>
					</form>
				</div>
			</div>

			<!-- Thông tin đơn hàng -->
			<div class="white_shd full margin_bottom_30">
				<div class="full graph_head">
					<div class="heading1 margin_0">
						<h2>Đơn hàng của bạn</h2>
					</div>
				</div>
				<div class="full padding_infor_info">
					<div class="table-responsive">
						<table class="table table-bordered">
							<thead>
								<tr>
									<th>Sản phẩm</th>
									<th>Số lượng</th>
									<th class="text-right">Đơn giá</th>
									<th class="text-right">Thành tiền</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="item : ${cartDetails}">
									<td>
										<div class="d-flex align-items-center">
											<img th:src="@{'/images/products/' + ${item.product.image}}" alt="Product"
												width="50">
											<span class="ml-2" th:text="${item.product.name}"></span>
										</div>
									</td>
									<td th:text="${item.quantity}"></td>
									<td class="text-right"
										th:text="'$' + ${#numbers.formatDecimal(item.price, 0, 'COMMA', 2, 'POINT')}">
									</td>
									<td class="text-right"
										th:text="'$' + ${#numbers.formatDecimal(item.price * item.quantity, 0, 'COMMA', 2, 'POINT')}">
									</td>
								</tr>
							</tbody>
							<tfoot>
								<tr>
									<td colspan="3" class="text-right"><strong>Tạm tính:</strong></td>
									<td class="text-right"
										th:text="'$' + ${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 2, 'POINT')}">
									</td>
								</tr>
								<tr>
									<td colspan="3" class="text-right">Phí vận chuyển:</td>
									<td class="text-right">$0.00</td>
								</tr>
								<tr>
									<td colspan="3" class="text-right"><strong>Tổng cộng:</strong></td>
									<td class="text-right"><strong
											th:text="'$' + ${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 2, 'POINT')}"></strong>
									</td>
								</tr>
							</tfoot>
						</table>
					</div>

					<div class="text-right mt-4">
						<!-- Thay thế nút thanh toán cũ -->
						<button type="button" class="btn btn-primary btn-lg" data-bs-toggle="modal"
							data-bs-target="#paymentModal">
							Thanh toán
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>


	<!-- Thêm Modal Payment Form -->
	<div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="paymentModalLabel">Thông tin thanh toán</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form id="payment-form" th:action="@{/user/checkout/process-payment}" method="post">
						<div class="mb-3">
							<label for="cardName" class="form-label">Tên chủ thẻ *</label>
							<input type="text" class="form-control" id="cardName" name="cardName" required>
						</div>

						<div class="mb-3">
							<label for="cardNumber" class="form-label">Số thẻ *</label>
							<input type="text" class="form-control" id="cardNumber" name="cardNumber"
								placeholder="XXXX-XXXX-XXXX-XXXX" required>
						</div>

						<div class="row">
							<div class="col-md-6 mb-3">
								<label for="expiryDate" class="form-label">Ngày hết hạn *</label>
								<input type="text" class="form-control" id="expiryDate" name="expiryDate"
									placeholder="MM/YY" required>
							</div>
							<div class="col-md-6 mb-3">
								<label for="cvv" class="form-label">CVV *</label>
								<input type="text" class="form-control" id="cvv" name="cvv" placeholder="123" required>
							</div>
						</div>

						<!-- Hiển thị tổng tiền -->
						<div class="alert alert-info mt-3">
							Số tiền thanh toán: <strong
								th:text="'$' + ${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 2, 'POINT')}"></strong>
						</div>

						<input type="hidden" name="orderId" th:value="${orderId}">
						<input type="hidden" name="amount" th:value="${totalPrice}">
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
					<button type="submit" form="payment-form" class="btn btn-primary">Xác nhận thanh toán</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Form validation script -->
	<script>
		(function () {
			'use strict';
			window.addEventListener('load', function () {
				var forms = document.getElementsByClassName('needs-validation');
				Array.prototype.filter.call(forms, function (form) {
					form.addEventListener('submit', function (event) {
						if (form.checkValidity() === false) {
							event.preventDefault();
							event.stopPropagation();
						}
						form.classList.add('was-validated');
					}, false);
				});
			});
		})();
	</script>

	<!-- Thêm JavaScript để validate form thanh toán -->
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			// Format số thẻ
			document.getElementById('cardNumber').addEventListener('input', function (e) {
				let value = e.target.value.replace(/\D/g, '');
				value = value.replace(/(\d{4})(?=\d)/g, '$1-');
				e.target.value = value;
			});

			// Format ngày hết hạn
			document.getElementById('expiryDate').addEventListener('input', function (e) {
				let value = e.target.value.replace(/\D/g, '');
				if (value.length >= 2) {
					value = value.slice(0, 2) + '/' + value.slice(2);
				}
				e.target.value = value;
			});

			// Format CVV
			document.getElementById('cvv').addEventListener('input', function (e) {
				e.target.value = e.target.value.replace(/\D/g, '').slice(0, 3);
			});

			// Validate form trước khi submit
			document.getElementById('payment-form').addEventListener('submit', function (e) {
				e.preventDefault();

				// Thêm validation logic ở đây

				// Nếu validate thành công thì submit form
				this.submit();
			});
		});
	</script>

</body>

</html>