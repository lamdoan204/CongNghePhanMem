<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ªëng K√™ Doanh Thu Chuy√™n Nghi·ªáp</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.7.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-gradient@0.1.0/dist/chartjs-plugin-gradient.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    
    <style>
        :root {
            --primary-color: #3B82F6;
            --secondary-color: #10B981;
            --background-light: #F3F4F6;
            --card-background: #FFFFFF;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--background-light);
            line-height: 1.6;
        }
        .dashboard-card {
            border-radius: 12px;
            border: none;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), #6366F1);
            color: white;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .stat-icon {
            font-size: 2.5rem;
            opacity: 0.7;
        }
        .filter-container {
            background-color: var(--card-background);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }
        .select2-container {
            width: 100% !important;
        }
        .chart-container {
            position: relative;
            height: 350px;
        }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f7;
            line-height: 1.6;
        }
        .revenue-dashboard {
            max-width: 1200px;
            margin: 30px auto;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        .tabs {
            display: flex;
            background-color: #007bff;
            color: white;
        }
        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .tab:hover {
            background-color: #0056b3;
        }
        .tab.active {
            background-color: #0056b3;
            font-weight: bold;
        }
        .tab-content {
            display: none;
            padding: 20px;
        }
        .tab-content.active {
            display: block;
        }
         /* ƒê·ªãnh d·∫°ng b·∫£ng v√† thanh cu·ªôn */
        .table-container {
            max-height: 400px; /* ƒê·∫∑t chi·ªÅu cao t·ªëi ƒëa cho b·∫£ng */
            overflow-y: auto;  /* Cho ph√©p thanh cu·ªôn d·ªçc khi c√≥ qu√° nhi·ªÅu d√≤ng */
            border: 1px solid #ddd; /* ƒê·∫∑t ƒë∆∞·ªùng vi·ªÅn quanh b·∫£ng */
            margin-bottom: 20px; /* Kho·∫£ng c√°ch d∆∞·ªõi c√πng */
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #e9ecef;
        }
        
#resetButton i {
    font-size: 16px; /* T√πy ch·ªânh k√≠ch th∆∞·ªõc bi·ªÉu t∆∞·ª£ng */
}

#resetButton:hover {
    background-color: #d32f2f;
}
        /* Header Th·ªëng k√™ doanh thu */
.header-revenue-statistics {
    background: linear-gradient(135deg, #34D399, #10B981); /* Gradient t·ª´ xanh l√° s√°ng (#34D399) ƒë·∫øn xanh l√° ƒë·∫≠m (#10B981) */
    color: #fff; /* M√†u ch·ªØ tr·∫Øng n·ªïi b·∫≠t */
    padding: 2rem;
    border-radius: 0 0 20px 20px; /* Bo g√≥c ƒë√°y */
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15); /* Hi·ªáu ·ª©ng ƒë·ªï b√≥ng nh·∫π */
    position: relative;
    overflow: hidden;
}

/* Hi·ªáu ·ª©ng n·ªÅn ƒë·ªông */
.header-revenue-statistics::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, 
        rgba(255, 255, 255, 0.3) 25%, 
        transparent 25%, 
        transparent 50%, 
        rgba(255, 255, 255, 0.3) 50%, 
        rgba(255, 255, 255, 0.3) 75%, 
        transparent 75%, 
        transparent);
    background-size: 60px 60px;
    animation: moveStripes 3s linear infinite; /* Hi·ªáu ·ª©ng di chuy·ªÉn */
    opacity: 0.2; /* ƒê·ªô m·ªù */
}

/* Animation cho hi·ªáu ·ª©ng n·ªÅn */
@keyframes moveStripes {
    0% {
        background-position: 0 0;
    }
    100% {
        background-position: 60px 60px;
    }
}


    </style>
</head>
<body>
    <!-- Header -->
    <div th:replace="~{manager/header}"></div> 
    <!-- Header c·ªßa trang Th·ªëng k√™ doanh thu -->
<div class="page-header text-center header-revenue-statistics">
    <h1><i class="fas fa-chart-line me-2"></i>Th·ªëng K√™ Doanh Thu</h1>
    <p class="lead">T·ªïng h·ª£p v√† ph√¢n t√≠ch doanh thu theo th·ªùi gian,ph√¢n lo·∫°i v√† s·∫£n ph·∫©m b√°n ch·∫°y</p>
    <!-- Hi·ªÉn th·ªã t√™n th∆∞∆°ng hi·ªáu -->
	 <div class="brand-info" style="color: black; align-items: center">
	    <strong>
	        <i class="fas fa-cogs"></i> <!-- Th√™m icon cogs t·ª´ Font Awesome -->
	        Th∆∞∆°ng hi·ªáu qu·∫£n l√Ω: 
	    </strong>
	    <span th:text="${brand}"></span>
	</div>
</div>
<!-- V√≠ d·ª• v·ªõi Thymeleaf -->
<div class="revenue-dashboard">
    <p class="lead" style="color: #007bff; font-weight: bold; font-size: 1.2em;">
        <i class="fas fa-box-open" style="color: purple; margin-right: 8px;"></i>
        B√ÅO C√ÅO NH·∫¨P KHO S·∫¢N PH·∫®M
    </p>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Ng√†y nh·∫≠p</th>
                    <th>T√™n s·∫£n ph·∫©m</th>
                    <th>Lo·∫°i s·∫£n ph·∫©m</th>
                    <th>S·ªë l∆∞·ª£ng nh·∫≠p kho</th>
                </tr>
            </thead>
            <tbody>
                <!-- Check if stockReport is null or empty -->
                <tr th:if="${#lists.isEmpty(stockReport)}">
                    <td colspan="4" class="text-center text-muted">
                        Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã
                    </td>
                </tr>
                <!-- Loop through stockReport if not empty -->
                <tr th:each="stock : ${stockReport}">
                    <td th:text="${stock.stockDate != null ? #temporals.format(stock.stockDate, 'dd/MM/yyyy') : ''}">Ng√†y nh·∫≠p</td>
                    <td th:text="${stock.productName}">T√™n s·∫£n ph·∫©m</td>
                    <td th:text="${stock.productKind}">Lo·∫°i s·∫£n ph·∫©m</td>
                    <td th:text="${stock.totalQuantityInStock}">S·ªë l∆∞·ª£ng nh·∫≠p kho</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="revenue-dashboard">
<p class="lead" style="color: #007bff; font-weight: bold; font-size: 1.2em;">
    <i class="fas fa-file-alt" style="color: #ff5722; margin-right: 8px;"></i> 
    B√ÅO C√ÅO DOANH THU CHI TI·∫æT
    
</p>
   

<div class="table-container">
    <!-- Combobox ch·ªçn nƒÉm -->
    <div class="filter-year">
        <select id="year" name="year" onchange="filterDataByYear()">
            <option value="" disabled selected>Ch·ªçn NƒÉm</option>
            <!-- C√°c nƒÉm s·∫Ω ƒë∆∞·ª£c th√™m v√†o ·ªü ƒë√¢y -->
        </select>

        <select id="month" name="month" onchange="filterDataByMonth()">
            <option value="" disabled selected>Ch·ªçn Th√°ng</option>
            <option value="1">Th√°ng 1</option>
            <option value="2">Th√°ng 2</option>
            <option value="3">Th√°ng 3</option>
            <option value="4">Th√°ng 4</option>
            <option value="5">Th√°ng 5</option>
            <option value="6">Th√°ng 6</option>
            <option value="7">Th√°ng 7</option>
            <option value="8">Th√°ng 8</option>
            <option value="9">Th√°ng 9</option>
            <option value="10">Th√°ng 10</option>
            <option value="11">Th√°ng 11</option>
            <option value="12">Th√°ng 12</option>
        </select>
        
       
    </div>

    <table id="monthlyTable">
        <thead>
            <tr>
                <th>Th√°ng</th>
                <th>NƒÉm</th>
                <th>T√™n s·∫£n ph·∫©m</th>
               
                <th>S·ªë l∆∞·ª£ng xu·∫•t kho</th>
                <th>S·ªë l∆∞·ª£ng t·ªìn kho</th>
                <th>Doanh thu</th>
            </tr>
        </thead>

        <tbody>
            <!-- N·∫øu danh s√°ch c√≥ d·ªØ li·ªáu -->
            <tr th:each="revenue : ${monthlyRevenues}">
                <td th:text="${revenue.period}">Th√°ng</td>
                <td th:text="${revenue.year}">NƒÉm</td>
                <td th:text="${revenue.productName}">T√™n s·∫£n ph·∫©m</td>
               
                <td th:text="${revenue.totalQuantitySold}">S·ªë l∆∞·ª£ng xu·∫•t kho</td>
                <td th:text="${revenue.remainingQuantity}">S·ªë l∆∞·ª£ng t·ªìn kho</td>
                <td th:text="${revenue.totalRevenue}">Doanh thu</td>
            </tr>
            <!-- D√≤ng t·ªïng doanh thu -->
            <tr id="totalRevenueRow">
                <td colspan="6" style="text-align: right; font-weight: bold;">T·ªïng Doanh Thu:</td>
                <td id="totalRevenue">0</td>
            </tr>
        </tbody>
    </table>
</div>


</div>

  
<div class="revenue-dashboard">
    <p class="lead" style="color: #007bff; font-weight: bold; font-size: 1.2em;">
        <i class="fas fa-chart-bar" style="color: #28a745; margin-right: 8px;"></i> 
        BI·ªÇU ƒê·ªí TH·ªêNG K√ä DOANH THU
    </p>
    
    <div class="row g-4">
        <!-- Filters -->
        <div class="col-lg-4">
            <div class="filter-container">
                <h3 class="mb-4 text-center">B·ªô L·ªçc Th√¥ng Minh</h3>
                <!-- Ch·ªçn NƒÉm -->
                <div class="mb-3">
                    <label class="form-label">Ch·ªçn NƒÉm</label>
                    <select id="yearFilter" class="form-select">
                        <!-- C√°c nƒÉm s·∫Ω ƒë∆∞·ª£c th√™m qua JavaScript -->
                    </select>
                </div>
                

                <!-- Ch·ªçn Th·ªùi Gian (Ch·ªâ Th√°ng) -->
                <div class="mb-3" style="display: none;">
                    <label class="form-label">Ch·ªçn Th·ªùi Gian</label>
                    <select id="timeFilter" class="form-select" disabled>
                        <option value="monthly">Th√°ng</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="col-lg-8">
            <div class="row g-4">
                <!-- T·ªïng Doanh Thu -->
                <div class="col-md-6">
                    <div class="stat-card">
                        <div>
                            <h5 class="mb-2">T·ªïng Doanh Thu</h5>
                            <h3 id="totalRevenues" class="mb-0">0 ƒë</h3>
                        </div>
                        <i class="stat-icon">üí∞</i>
                    </div>
                </div>
                <!-- TƒÉng Tr∆∞·ªüng -->
                <div class="col-md-6">
                    <div class="stat-card" style="background: linear-gradient(135deg, #10B981, #34D399);">
                        <div>
                            <h5 class="mb-2">TƒÉng Tr∆∞·ªüng</h5>
                            <h3 id="revenueGrowth" class="mb-0">0%</h3>
                        </div>
                        <i class="stat-icon">üìà</i>
                    </div>
                </div>

                <!-- Bi·ªÉu ƒê·ªì -->
                <div class="col-md-6">
                    <div class="card dashboard-card h-100">
                        <div class="card-body">
                            <h5 class="card-title text-center mb-4">Bi·ªÉu ƒê·ªì Doanh Thu</h5>
                            <div class="chart-container">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card dashboard-card h-100">
                        <div class="card-body">
                            <h5 class="card-title text-center mb-4">Ph√¢n B·ªï Doanh Thu</h5>
                            <div class="chart-container">
                                <canvas id="revenuePieChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script th:inline="javascript">
    // Truy·ªÅn d·ªØ li·ªáu t·ª´ Spring v√†o JavaScript qua Thymeleaf
    const monthlyRevenue = /*[[${monthlyRevenues}]]*/ [];
    console.log('Monthly Revenue:', monthlyRevenue);

    // Th√™m danh s√°ch c√°c nƒÉm t·ª´ d·ªØ li·ªáu c√≥ s·∫µn
    const availableYears = [...new Set(monthlyRevenue.map(item => item.year))]; // L·∫•y c√°c nƒÉm t·ª´ monthlyRevenue
    const yearSelect = document.getElementById('yearFilter');

    // Th√™m c√°c nƒÉm v√†o dropdown
    availableYears.forEach(year => {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearSelect.appendChild(option);
    });

    // Set nƒÉm m·∫∑c ƒë·ªãnh l√† nƒÉm hi·ªán t·∫°i ho·∫∑c m·ªôt nƒÉm trong danh s√°ch
    const currentYear = new Date().getFullYear();
    if (availableYears.includes(currentYear.toString())) {
        yearSelect.value = currentYear.toString();
    } else {
        yearSelect.value = availableYears[0]; // Ch·ªçn nƒÉm ƒë·∫ßu ti√™n n·∫øu nƒÉm hi·ªán t·∫°i kh√¥ng c√≥ trong danh s√°ch
    }

    // H√†m format currency
    function formatCurrency(amount) {
        return new Intl.NumberFormat('vi-VN', { 
            style: 'currency', 
            currency: 'VND' 
        }).format(amount);
    }

    // H√†m l·ªçc d·ªØ li·ªáu theo nƒÉm v√† th√°ng
    function filterRevenueData(selectedYear) {
        let filteredData = [];

        // L·ªçc theo nƒÉm
        filteredData = monthlyRevenue.filter(item => item.year == selectedYear)
                                     .map(item => ({
                                         period: ` ${item.productName}`,
                                         revenue: item.totalRevenue
                                     }));

        return filteredData;
    }

    let revenueChart, revenuePieChart;

    // H√†m c·∫≠p nh·∫≠t dashboard
    function updateDashboard() {
        const selectedYear = document.getElementById('yearFilter').value;

        // L·ªçc d·ªØ li·ªáu theo nƒÉm
        const data = filterRevenueData(selectedYear);

        // Revenue Line Chart with Gradient
        if (revenueChart) revenueChart.destroy();
        revenueChart = new Chart(document.getElementById('revenueChart'), {
            type: 'line',
            data: {
                labels: data.map(item => item.period),
                datasets: [{
                    label: 'Doanh Thu',
                    data: data.map(item => item.revenue),
                    borderColor: 'var(--primary-color)',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    fill: true,
                    tension: 0.4,
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(tooltipItem) {
                                return `${tooltipItem.label}: ${formatCurrency(tooltipItem.raw)}`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.05)'
                        }
                    }
                }
            }
        });

        // Revenue Pie Chart with Improved Styling
        if (revenuePieChart) revenuePieChart.destroy();
        revenuePieChart = new Chart(document.getElementById('revenuePieChart'), {
            type: 'pie',
            data: {
                labels: data.map(item => item.period),
                datasets: [{
                    data: data.map(item => item.revenue),
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.8)',   // Primary Blue
                        'rgba(16, 185, 129, 0.8)',   // Green
                        'rgba(245, 158, 11, 0.8)',   // Amber
                        'rgba(139, 92, 246, 0.8)',   // Purple
                        'rgba(255, 99, 132, 0.8)',   // Red
                        'rgba(54, 162, 235, 0.8)',   // Blue
                        'rgba(255, 206, 86, 0.8)',   // Yellow
                    ],
                    borderColor: '#fff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            usePointStyle: true
                        }
                    }
                }
            }
        });

     // Ki·ªÉm tra gi√° tr·ªã c·ªßa selectedYear
        console.log(selectedYear);  

        // Ki·ªÉm tra d·ªØ li·ªáu trong monthlyRevenue
        console.log(monthlyRevenue);  

        // Ki·ªÉm tra d·ªØ li·ªáu sau khi filter
        const filteredData = monthlyRevenue.filter(item => item.year === parseInt(selectedYear) - 1);
        console.log(filteredData);  // Ki·ªÉm tra d·ªØ li·ªáu c·ªßa nƒÉm tr∆∞·ªõc

        // T√≠nh t·ªïng doanh thu nƒÉm tr∆∞·ªõc
        const previousYearRevenue = filteredData.map(item => item.totalRevenue)
                                                 .reduce((acc, revenue) => acc + revenue, 0);
        console.log(previousYearRevenue);  // Ki·ªÉm tra gi√° tr·ªã c·ªßa previousYearRevenue

        // T√≠nh t·ªïng doanh thu hi·ªán t·∫°i
        const totalRevenues = data.reduce((acc, item) => acc + item.revenue, 0);
        console.log(totalRevenues);
        // T√≠nh t·ª∑ l·ªá tƒÉng tr∆∞·ªüng
        const growth = previousYearRevenue > 0 ? ((totalRevenues - previousYearRevenue) / previousYearRevenue * 100).toFixed(2) : 0;
      
        document.getElementById('totalRevenues').textContent = formatCurrency(totalRevenues);
        document.getElementById('revenueGrowth').textContent = `${growth}%`;


    }

    // S·ª± ki·ªán thay ƒë·ªïi b·ªô l·ªçc nƒÉm
    document.getElementById('yearFilter').addEventListener('change', updateDashboard);

    // C·∫≠p nh·∫≠t dashboard l·∫ßn ƒë·∫ßu ti√™n
    updateDashboard();
</script>


<script>

// H√†m ƒë·ªÉ t√≠nh to√°n v√† ƒëi·ªÅn c√°c nƒÉm t·ª´ nƒÉm hi·ªán t·∫°i tr·ªü v·ªÅ tr∆∞·ªõc v√†o combobox
function populateYearDropdown() {
    const currentYear = new Date().getFullYear();  // L·∫•y nƒÉm hi·ªán t·∫°i
    const yearDropdown = document.getElementById('year');
    
    // Ch·ªâ th√™m c√°c nƒÉm t·ª´ hi·ªán t·∫°i tr·ªü v·ªÅ tr∆∞·ªõc (v√≠ d·ª•: 2024, 2023, 2022,...)
    for (let year = currentYear; year >= 2000; year--) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearDropdown.appendChild(option);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // T·ª± ƒë·ªông ch·ªçn nƒÉm v√† th√°ng hi·ªán t·∫°i
    const currentDate = new Date();
    const currentYear = currentDate.getFullYear();
 

    // ƒê·∫∑t gi√° tr·ªã m·∫∑c ƒë·ªãnh cho combobox nƒÉm v√† th√°ng
    const yearDropdown = document.getElementById('year');
   

    // ƒê·∫∑t nƒÉm hi·ªán t·∫°i v√†o combobox nƒÉm
    yearDropdown.value = currentYear;

   

    // G·ªçi h√†m filterDataByYear ƒë·ªÉ l·ªçc d·ªØ li·ªáu theo nƒÉm v√† th√°ng hi·ªán t·∫°i
    filterDataByYear();
});

// H√†m l·ªçc d·ªØ li·ªáu theo nƒÉm ƒë√£ ch·ªçn
function filterDataByYear() {
    const selectedYear = document.getElementById('year').value; // L·∫•y nƒÉm ƒë√£ ch·ªçn
    const selectedMonth = document.getElementById('month').value; // L·∫•y th√°ng ƒë√£ ch·ªçn

    // Ki·ªÉm tra n·∫øu ng∆∞·ªùi d√πng ch∆∞a ch·ªçn nƒÉm ho·∫∑c th√°ng
    if (!selectedYear || !selectedMonth) {
        return;
    }

    console.log("ƒê√£ ch·ªçn nƒÉm:", selectedYear);
    console.log("ƒê√£ ch·ªçn th√°ng:", selectedMonth);

    // L·ªçc d·ªØ li·ªáu t·ª´ c√°c bi·∫øn ƒë√£ truy·ªÅn theo nƒÉm v√† th√°ng
    const filteredMonthly = monthlyRevenue.filter(item => 
        item.year == selectedYear && item.period == selectedMonth
    );

    // Hi·ªÉn th·ªã l·∫°i d·ªØ li·ªáu ƒë√£ l·ªçc trong b·∫£ng
    displayDataInTable('monthly', filteredMonthly);

    // T√≠nh t·ªïng doanh thu c·ªßa d·ªØ li·ªáu ƒë√£ l·ªçc
    const totalRevenue = calculateTotalRevenue(filteredMonthly);

    // Hi·ªÉn th·ªã t·ªïng doanh thu ·ªü cu·ªëi b·∫£ng
    displayTotalRevenue(totalRevenue);
}

// H√†m l·ªçc d·ªØ li·ªáu theo th√°ng ƒë√£ ch·ªçn
function filterDataByMonth() {
    const selectedYear = document.getElementById('year').value; // L·∫•y nƒÉm ƒë√£ ch·ªçn
    const selectedMonth = document.getElementById('month').value; // L·∫•y th√°ng ƒë√£ ch·ªçn

    // Ki·ªÉm tra n·∫øu ng∆∞·ªùi d√πng ch∆∞a ch·ªçn nƒÉm ho·∫∑c th√°ng
    if (!selectedYear || !selectedMonth) {
        return;
    }

    console.log("ƒê√£ ch·ªçn nƒÉm:", selectedYear);
    console.log("ƒê√£ ch·ªçn th√°ng:", selectedMonth);

    // L·ªçc d·ªØ li·ªáu t·ª´ c√°c bi·∫øn ƒë√£ truy·ªÅn theo nƒÉm v√† th√°ng
    const filteredMonthly = monthlyRevenue.filter(item => 
        item.year == selectedYear && item.period == selectedMonth
    );

    // Hi·ªÉn th·ªã l·∫°i d·ªØ li·ªáu ƒë√£ l·ªçc trong b·∫£ng
    displayDataInTable('monthly', filteredMonthly);

    // T√≠nh t·ªïng doanh thu c·ªßa d·ªØ li·ªáu ƒë√£ l·ªçc
    const totalRevenue = calculateTotalRevenue(filteredMonthly);

    // Hi·ªÉn th·ªã t·ªïng doanh thu ·ªü cu·ªëi b·∫£ng
    displayTotalRevenue(totalRevenue);
}

// H√†m t√≠nh t·ªïng doanh thu
function calculateTotalRevenue(data) {
    return data.reduce((total, item) => total + item.totalRevenue, 0);
}

function displayTotalRevenue(totalRevenue) {
    const tableBody = document.querySelector('#monthlyTable tbody');
    
    // Ki·ªÉm tra xem ƒë√£ c√≥ d√≤ng t·ªïng doanh thu ch∆∞a, n·∫øu c√≥ th√¨ x√≥a ƒëi
    const existingTotalRow = document.querySelector('.total-revenue-row');
    if (existingTotalRow) {
        existingTotalRow.remove();
    }

    // Th√™m m·ªôt d√≤ng t·ªïng doanh thu m·ªõi
    const tr = document.createElement('tr');
    tr.classList.add('total-revenue-row');
    tr.innerHTML = `
        <td colspan="6" style="text-align: right; font-weight: bold;">T·ªïng Doanh Thu:</td>
        <td>${totalRevenue.toLocaleString()}</td>
    `;
    
    // Th√™m d√≤ng v√†o cu·ªëi tbody
    tableBody.appendChild(tr);
}


function displayDataInTable(type, data) {
    const tableBody = document.querySelector(`#${type}Table tbody`);
    tableBody.innerHTML = ''; // X√≥a n·ªôi dung c≈©

    // Hi·ªÉn th·ªã c√°c d√≤ng d·ªØ li·ªáu
    data.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${item.period}</td>
            <td>${item.year}</td>
            <td>${item.productName}</td>
            
            <td>${item.totalQuantitySold}</td>
            <td>${item.remainingQuantity}</td>
            <td>${item.totalRevenue}</td>
        `;
        tableBody.appendChild(tr);
    });
}




// G·ªçi h√†m ƒë·ªÉ ƒëi·ªÅn combobox khi trang ƒë∆∞·ª£c t·∫£i
window.onload = function() {
    populateYearDropdown();
};
//G·ªçi h√†m ƒë·ªÉ ƒëi·ªÅn combobox khi trang ƒë∆∞·ª£c t·∫£i
window.onload = function() {
    populateYearDropdown();
    displayDataInTable('monthly', monthlyRevenue);  // Hi·ªÉn th·ªã to√†n b·ªô d·ªØ li·ªáu ban ƒë·∫ßu
};
</script>

   
    <!-- Footer -->
    <div th:replace="~{manager/footer}"></div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    
    
    
</body>
</html>
